{"version":3,"sources":["test/lib/geocode_test.js","test/lib/localstorage_memoize_test.js","test/lib/unique_counter_test.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"public/test/test.js","sourcesContent":["var geocode = require(\"lib/geocode\");\n\ndescribe('geocode', function() {\n  var sandbox;\n\n  beforeEach(function() {\n    sandbox = sinon.sandbox.create();\n  });\n\n  afterEach(function() {\n    sandbox.restore();\n  });\n\n  it('retrieves lat/long for a string query', function(done) {\n    // TODO(jlfwong): Figure out why this doesn't work with\n    // sinon.useFakeXMLHttpRequest();\n    var deferred = $.Deferred();\n    var ajaxStub = sandbox.stub($, 'ajax').returns(deferred.promise());\n    geocode(\"paris\").then(function(latlon) {\n      expect(latlon.lat).to.be(48.8565056);\n      expect(latlon.lon).to.be(2.3521334);\n      done();\n    });\n    deferred.resolveWith(deferred, [PARIS_RESPONSE]);\n  });\n\n  describe('.reverse', function() {\n    it('retrieves address information for a given lat/lon', function(done) {\n      var deferred = $.Deferred();\n      var ajaxStub = sandbox.stub($, 'ajax').returns(deferred.promise());\n      geocode.reverse({lat: 48.8565056, lon: 2.3521334}).then(function(result) {\n        expect(result.display_name).to.be(\"Paris, Ile-de-France, France\");\n        expect(result.address.country_code).to.be(\"fr\");\n        done();\n      });\n      deferred.resolveWith(deferred, [PARIS_REVERSE_RESPONSE]);\n    });\n  });\n});\n\nvar PARIS_RESPONSE = [\n    {\n        \"boundingbox\": [\n            \"48.8155746459961\",\n            \"48.902156829834\",\n            \"2.22412180900574\",\n            \"2.46976041793823\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Ile-de-France, 75000, France\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.96893459932191,\n        \"lat\": \"48.8565056\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"2.3521334\",\n        \"osm_id\": \"7444\",\n        \"osm_type\": \"relation\",\n        \"place_id\": \"97923440\",\n        \"type\": \"city\"\n    },\n    {\n        \"boundingbox\": [\n            \"48.8155746459961\",\n            \"48.902156829834\",\n            \"2.22412180900574\",\n            \"2.46976041793823\"\n        ],\n        \"class\": \"boundary\",\n        \"display_name\": \"Paris, Ile-de-France, France\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png\",\n        \"importance\": 0.96893459932191,\n        \"lat\": \"48.85886575\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"2.32003761177144\",\n        \"osm_id\": \"71525\",\n        \"osm_type\": \"relation\",\n        \"place_id\": \"97357969\",\n        \"type\": \"administrative\"\n    },\n    {\n        \"boundingbox\": [\n            \"35.2672462463379\",\n            \"35.3065032958984\",\n            \"-93.7618103027344\",\n            \"-93.6750793457031\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Logan County, Arkansas, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.67385884862688,\n        \"lat\": \"35.28687645\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-93.7354879210082\",\n        \"osm_id\": \"33063046\",\n        \"osm_type\": \"way\",\n        \"place_id\": \"42637879\",\n        \"type\": \"city\"\n    },\n    {\n        \"boundingbox\": [\n            \"33.6118507385254\",\n            \"33.7383804321289\",\n            \"-95.6279296875\",\n            \"-95.4354476928711\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Lamar County, Texas, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.54374443751163,\n        \"lat\": \"33.6751155\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-95.5502662477703\",\n        \"osm_id\": \"33299478\",\n        \"osm_type\": \"way\",\n        \"place_id\": \"42729434\",\n        \"type\": \"city\"\n    },\n    {\n        \"boundingbox\": [\n            \"38.1649208068848\",\n            \"38.2382736206055\",\n            \"-84.3073272705078\",\n            \"-84.2320861816406\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Bourbon County, Kentucky, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.5108263210417,\n        \"lat\": \"38.2097987\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-84.2529869\",\n        \"osm_id\": \"130722\",\n        \"osm_type\": \"relation\",\n        \"place_id\": \"97962432\",\n        \"type\": \"city\"\n    },\n    {\n        \"boundingbox\": [\n            \"36.1119995117188\",\n            \"36.112003326416\",\n            \"-115.172668457031\",\n            \"-115.172660827637\"\n        ],\n        \"class\": \"highway\",\n        \"display_name\": \"Paris, South Las Vegas Boulevard, Hughes Center, Bracken, Clark County, Nevada, 89169, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/transport_bus_stop2.p.20.png\",\n        \"importance\": 0.4846342182247,\n        \"lat\": \"36.1120019\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-115.1726609\",\n        \"osm_id\": \"1688891876\",\n        \"osm_type\": \"node\",\n        \"place_id\": \"18310048\",\n        \"type\": \"bus_stop\"\n    },\n    {\n        \"boundingbox\": [\n            \"43.1932334899902\",\n            \"43.1932373046875\",\n            \"-80.3842849731445\",\n            \"-80.38427734375\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Brant County, Ontario, Canada\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_town.p.20.png\",\n        \"importance\": 0.46561345354774,\n        \"lat\": \"43.1932336\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-80.3842807\",\n        \"osm_id\": \"257763716\",\n        \"osm_type\": \"node\",\n        \"place_id\": \"3669487431\",\n        \"type\": \"town\"\n    },\n    {\n        \"boundingbox\": [\n            \"39.4691543579102\",\n            \"39.4892807006836\",\n            \"-92.021484375\",\n            \"-91.9916763305664\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Monroe County, Missouri, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.44025131828771,\n        \"lat\": \"39.4808721\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-92.0012811\",\n        \"osm_id\": \"140787\",\n        \"osm_type\": \"relation\",\n        \"place_id\": \"97967436\",\n        \"type\": \"city\"\n    },\n    {\n        \"boundingbox\": [\n            \"39.5814208984375\",\n            \"39.6485786437988\",\n            \"-87.7210464477539\",\n            \"-87.6505355834961\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Edgar County, Illinois, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.43634000491239,\n        \"lat\": \"39.611146\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-87.6961374\",\n        \"osm_id\": \"126166\",\n        \"osm_type\": \"relation\",\n        \"place_id\": \"97975024\",\n        \"type\": \"city\"\n    },\n    {\n        \"boundingbox\": [\n            \"36.2660026550293\",\n            \"36.3290176391602\",\n            \"-88.3671188354492\",\n            \"-88.2650604248047\"\n        ],\n        \"class\": \"place\",\n        \"display_name\": \"Paris, Henry County, Tennessee, United States of America\",\n        \"icon\": \"http://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\",\n        \"importance\": 0.43634000491239,\n        \"lat\": \"36.3020023\",\n        \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n        \"lon\": \"-88.3267107\",\n        \"osm_id\": \"197171\",\n        \"osm_type\": \"relation\",\n        \"place_id\": \"98009579\",\n        \"type\": \"city\"\n    }\n];\n\nvar PARIS_REVERSE_RESPONSE = {\n    \"address\": {\n        \"country\": \"France\",\n        \"country_code\": \"fr\",\n        \"county\": \"Paris\",\n        \"state\": \"Ile-de-France\"\n    },\n    \"display_name\": \"Paris, Ile-de-France, France\",\n    \"lat\": \"48.85886575\",\n    \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright\",\n    \"lon\": \"2.32003761177144\",\n    \"osm_id\": \"71525\",\n    \"osm_type\": \"relation\",\n    \"place_id\": \"97357969\"\n};\n","var localStorageMemoize = require(\"lib/localstorage_memoize\");\n\ndescribe('localStorageMemoize', function() {\n  it('returns identical results', function() {\n    var fib = function(n) {\n      return n < 2 ? n : fib(n - 1) + fib(n - 2);\n    };\n    var memoFib = localStorageMemoize('fib', fib);\n    expect(memoFib(10)).to.be(fib(10));\n    expect(memoFib(10)).to.be(fib(10));\n  });\n  it('uses all arguments for caching', function() {\n    var mult = function(a, b) {\n      return a * b;\n    };\n    var memoMult = localStorageMemoize('mult', mult);\n    memoMult.clear();\n    expect(mult(2, 3)).to.be(memoMult(2, 3));\n    expect(mult(2, 3)).to.be(memoMult(2, 3));\n    expect(mult(2, 3)).to.be(memoMult(2, 3));\n    expect(mult(2, 4)).to.be(memoMult(2, 4));\n    expect(mult(2, 4)).to.be(memoMult(2, 4));\n  });\n\n  describe('promise', function() {\n    it('returns identical results', function(done) {\n      var slowMult = function(a, b) {\n        var deferred = $.Deferred();\n        setTimeout(function() {\n          deferred.resolveWith(null, [a * b]);\n        }, 50);\n        return deferred.promise();\n      };\n      var memoSlowMult = localStorageMemoize.promise('slowMult', slowMult);\n      memoSlowMult.clear();\n\n      var sm = slowMult(3, 7);\n      var msm = memoSlowMult(3, 7);\n\n      $.when(sm, msm).then(function(m1, m2) {\n        expect(m1).to.be(m2);\n        memoSlowMult(3, 7).then(function(m3) {\n          expect(m3).to.be(m1);\n          done();\n        });\n      });\n    });\n  });\n});\n","var uniqueCounter = require(\"lib/unique_counter\");\n\ndescribe('uniqueCounter', function() {\n  it('allocates an int per unique item', function() {\n    var cnt = uniqueCounter();\n    expect(cnt('Jim')).to.be(0);\n    expect(cnt('Joe')).to.be(1);\n    expect(cnt('Jon')).to.be(2);\n    expect(cnt('Jim')).to.be(0);\n    expect(cnt('Jon')).to.be(2);\n\n    var cnt2 = uniqueCounter();\n    expect(cnt2('Bob')).to.be(0);\n    expect(cnt2('Ben')).to.be(1);\n    expect(cnt2('Bob')).to.be(0);\n    expect(cnt('Jon')).to.be(2);\n    expect(cnt('Jet')).to.be(3);\n  });\n});\n"]}